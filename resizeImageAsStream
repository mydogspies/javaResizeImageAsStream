public InputStream resizedImage (InputStream is, int width) throws IOException {

        double sigmaFactor = 0.3;
        int interpolationMethod = ImageProcessor.NONE; // equals 0

        BufferedImage img = ImageIO.read(is);
        ImagePlus imp = new ImagePlus("image", img);

        double scaleFactor = width/(double) imp.getWidth();

        ImageProcessor ip = imp.getProcessor();
        ip.blurGaussian(sigmaFactor / scaleFactor);
        ip.setInterpolationMethod(interpolationMethod);
        ImageProcessor outputProcessor = ip.resize((int)(ip.getWidth() * scaleFactor), (int)(ip.getHeight()*scaleFactor));
        BufferedImage newBuffImage = outputProcessor.getBufferedImage();

        final ByteArrayOutputStream output = new ByteArrayOutputStream() {
            @Override
            public synchronized byte[] toByteArray() {
                return this.buf;
            }
        };
        ImageIO.write(newBuffImage, "jpeg", output);
        return new ByteArrayInputStream(output.toByteArray(), 0, output.size());
    }
